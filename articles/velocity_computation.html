<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Velocity computation • saccadr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Velocity computation">
<meta property="og:description" content="saccadr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">saccadr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/methods.html">Implemented Methods</a>
    </li>
    <li>
      <a href="../articles/using_custom_methods.html">Using Custom Methods</a>
    </li>
    <li>
      <a href="../articles/using_sample_votes.html">Using Sample Votes</a>
    </li>
    <li>
      <a href="../articles/velocity_computation.html">Velocity computation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Velocity computation</h1>
            
      
      
      <div class="hidden name"><code>velocity_computation.Rmd</code></div>

    </div>

    
    
<p>Because the gaze samples tend to be noisy, different methods use
various approaches for computing velocity from noisy samples. Methods by
<span class="citation">Engbert and Kliegl (2003)</span> and <span class="citation">Otero-Millan et al. (2014)</span> used the same
approach based on averaging over multiple samples to compute velocity,
whereas <span class="citation">Nyström and Holmqvist (2010)</span>
compute a simple derivative and then filter it. By default, package uses
the former approach (<code>velocity_function = diff_ek</code>) but you
can also use the latter (<code>velocity_function = diff_nh</code>) or
implement a custom method (see below). Acceleration is computed the same
way but from velocity samples.</p>
<div class="section level2">
<h2 id="differentiation-following-engbertkliegl2003">Differentiation following <span class="citation">Engbert and Kliegl
(2003)</span><a class="anchor" aria-label="anchor" href="#differentiation-following-engbertkliegl2003"></a>
</h2>
<p>This method computes velocity over a predefined time window
controlled via <code>ek_velocity_time_window</code> that defaults to 20
ms. The width of the window is converted to samples based on the
<code>sampling_rate</code> parameter and is ensured to be an
<em>odd</em> number equal to or larger than 3. I.e., for a window that
is three samples long, the velocity is computed based on one sample
before and one sample after the current, for a five-samples window - two
samples before and after, etc. The code always starts with the requested
window size but all iteratively reduces it by two samples to accommodate
for trial limits and missing values. An <code>NA</code> velocity is
returned only if even the smallest window (three samples wide) cannot be
used.</p>
<p>In general, horizontal and vertical velocity components are computed
as <span class="math display">\[v_x[i] =
\frac{\sum_{j=1}^{(N-1)/2}x[i+j] -
x[i-j]}{\sum_{j=1}^{(N-1)/2}2j\cdot\Delta t}\]</span> where <span class="math inline">\(i\)</span> is the index of a sample, <span class="math inline">\(\Delta t = \frac{1}{sample~rate}\)</span> is a
duration of a single sampling frame, and <span class="math inline">\(N\)</span> is an <em>odd</em> integer width of the
moving average used to compute the velocity. In <span class="citation">Engbert and Kliegl (2003)</span>, <span class="math inline">\(N=5\)</span> and <span class="math inline">\(\Delta t = 4\)</span> (250 Hz sampling rate) that
translates into a 20 ms moving average window (default value used in the
method implementation). Below is a derivation that shows the equivalence
of the formula above to formula 1 in <span class="citation">Engbert and
Kliegl (2003)</span>. For <span class="math inline">\(N=5\)</span>:
<span class="math display">\[\frac{\sum_{j=1}^{(5-1)/2}x[i+j] -
x[i-j]}{\sum_{j=1}^{(5-1)/2}2j\cdot\Delta t}=\]</span> <span class="math display">\[\frac{\sum_{j=1}^{2}x[i+j] -
x[i-j]}{\sum_{j=1}^{2}2j\cdot\Delta t}=\]</span></p>
<p><span class="math display">\[\frac{x[i+1] - x[i-1]+x[i+2] -
x[i-2]}{2\Delta t + 4\Delta t}=\]</span> <span class="math display">\[\frac{x[i+2] + x[i+1] - x[i-1] - x[i-2]}{6\Delta
t}\]</span></p>
</div>
<div class="section level2">
<h2 id="differentiation-following-nystromholmqvist2010">Differentiation following <span class="citation">Nyström and
Holmqvist (2010)</span><a class="anchor" aria-label="anchor" href="#differentiation-following-nystromholmqvist2010"></a>
</h2>
<p>Horizontal and vertical components of velocity are computed from
adjacent samples, the amplitude is computed from the components and then
is filtered using <a href="https://en.wikipedia.org/wiki/Savitzky%E2%80%93Golay_filter" class="external-link">Savitzky-Golay
filter</a>. Filter order is controlled via
<code>nh_sg_filter_order</code> option and defaults to
<code>2</code>.</p>
</div>
<div class="section level2">
<h2 id="comparing-two-methods">Comparing two methods<a class="anchor" aria-label="anchor" href="#comparing-two-methods"></a>
</h2>
<p>The two methods produce comparable but different velocity values.
However, this has only a minor effect on saccade detection, see vignette
on <em>Using sample votes</em>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># computing velocity using two methods</span></span>
<span><span class="va">vel_ek</span> <span class="op">&lt;-</span> <span class="fu">saccadr</span><span class="fu">::</span><span class="fu"><a href="../reference/diff_ek.html">diff_ek</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">single_trial</span><span class="op">$</span><span class="va">x</span>,</span>
<span>                           y <span class="op">=</span> <span class="va">single_trial</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                           trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">single_trial</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           sample_rate <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">vel_nh</span> <span class="op">&lt;-</span> <span class="fu">saccadr</span><span class="fu">::</span><span class="fu"><a href="../reference/diff_nh.html">diff_nh</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">single_trial</span><span class="op">$</span><span class="va">x</span>,</span>
<span>                           y <span class="op">=</span> <span class="va">single_trial</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                           trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">single_trial</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           sample_rate <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">vel_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>EK <span class="op">=</span> <span class="va">vel_ek</span><span class="op">[[</span><span class="st">'amp'</span><span class="op">]</span><span class="op">]</span>, NH <span class="op">=</span> <span class="va">vel_nh</span><span class="op">[[</span><span class="st">'amp'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NH</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># values can be negative due to filtering</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>logEK <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">EK</span><span class="op">)</span>, logNH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">NH</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># plotting amplitude comparison</span></span>
<span><span class="va">pearson_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">vel_comparison</span><span class="op">[[</span><span class="st">'EK'</span><span class="op">]</span><span class="op">]</span>, <span class="va">vel_comparison</span><span class="op">[[</span><span class="st">'NH'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vel_comparison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">EK</span>, y <span class="op">=</span> <span class="va">NH</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Pearson's ρ = %.2f\nPearson's ρ for log transformed velocities = %.2f"</span>, <span class="va">pearson_rho</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">vel_comparison</span><span class="op">[[</span><span class="st">'logEK'</span><span class="op">]</span><span class="op">]</span>, <span class="va">vel_comparison</span><span class="op">[[</span><span class="st">'logNH'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Vek"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Vnh"</span><span class="op">)</span></span></code></pre></div>
<p><img src="velocity_computation_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># plotting </span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vel_comparison</span><span class="op">[[</span><span class="st">'EK'</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">vel_comparison</span><span class="op">[[</span><span class="st">'NH'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Vek - Vnh"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Difference in velocities computed via two methods"</span><span class="op">)</span></span></code></pre></div>
<p><img src="velocity_computation_files/figure-html/unnamed-chunk-2-2.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="implementing-and-using-a-custom-differentiation-function">Implementing and using a custom differentiation function<a class="anchor" aria-label="anchor" href="#implementing-and-using-a-custom-differentiation-function"></a>
</h2>
<p>A custom function should be as a follows</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>diff_custom <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y,  trial, sample_rate, <span class="at">options=</span><span class="cn">NULL</span>) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute vertical and horizontal components</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> ..., <span class="co"># differentiate values of x </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> ...) <span class="co"># differentiate values of y</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute amplitude</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  df[[<span class="st">'amp'</span>]] <span class="ot">=</span> <span class="fu">sqrt</span>(df[[<span class="st">'x'</span>]]<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> df[[<span class="st">'y'</span>]]<span class="sc">^</span><span class="dv">2</span>)<span class="er">)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return a data.frame with columns x, y, and amp</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Arguments that are passed to the function (all vectors have the same
length):</p>
<ul>
<li>
<code>x</code>, <code>y</code> vectors with values, either x and y
gaze coordinates or velocity components (for acceleration).</li>
<li>
<code>sample_rate</code> scalar value in Hz.</li>
<li>
<code>trial</code> vector with trial index per sample.</li>
<li>
<code>options</code> a named list with method specific options. See
example below for how to use them. See also
<code><a href="../reference/option_or_default.html">option_or_default()</a></code> function.</li>
</ul>
<p>The function must return a data.frame with three columns:
<code>x</code> (horizontal component), <code>y</code> (vertical
component), and <code>amp</code> (amplitude).</p>
<p>Here is an example of a simple velocity function that respects trial
borders</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">diff_custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>,  <span class="va">trial</span>, <span class="va">sample_rate</span>, <span class="va">options</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># computing frame time step </span></span>
<span>  <span class="va">delta_t_s</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">sample_rate</span></span>
<span>  </span>
<span>  <span class="co"># --- differentiate (compute velocity or acceleration) and filter</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>trial <span class="op">=</span> <span class="va">trial</span>,</span>
<span>             x <span class="op">=</span> <span class="va">x</span>,</span>
<span>             y <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>    <span class="co"># compute velocity and acceleration for each trial</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu">lag</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">delta_t_s</span>,</span>
<span>           y <span class="op">=</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">lag</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">delta_t_s</span>,</span>
<span>           amp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>And here is a similar function but that uses an optional
<code>custom_velocity_lag</code> parameter, so that it can be different
from 1</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diff_lag_n</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>,  <span class="va">trial</span>, <span class="va">sample_rate</span>, <span class="va">options</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># obtain lag or use default</span></span>
<span>  <span class="va">lag_n</span> <span class="op">&lt;-</span> <span class="fu">saccadr</span><span class="fu">::</span><span class="fu"><a href="../reference/option_or_default.html">option_or_default</a></span><span class="op">(</span><span class="va">options</span>, <span class="st">"custom_velocity_lag"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># computing frame time step </span></span>
<span>  <span class="va">delta_t_s</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">sample_rate</span></span>
<span>  </span>
<span>  <span class="co"># --- differentiate (compute velocity or acceleration) and filter</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>trial <span class="op">=</span> <span class="va">trial</span>,</span>
<span>             x <span class="op">=</span> <span class="va">x</span>,</span>
<span>             y <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>    <span class="co"># compute velocity and acceleration for each trial</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu">lag</span><span class="op">(</span><span class="va">x</span>, <span class="va">lag_n</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">delta_t_s</span>,</span>
<span>           y <span class="op">=</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">lag</span><span class="op">(</span><span class="va">y</span>, <span class="va">lag_n</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">delta_t_s</span>,</span>
<span>           amp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-EngbertKliegl2003" class="csl-entry">
Engbert, Ralf, and Reinhold Kliegl. 2003. <span>“<span class="nocase">Microsaccades uncover the orientation of covert
attention</span>.”</span> <em>Vision Research</em> 43 (9): 1035–45. <a href="https://doi.org/10.1016/S0042-6989(03)00084-1" class="external-link">https://doi.org/10.1016/S0042-6989(03)00084-1</a>.
</div>
<div id="ref-NystromHolmqvist2010" class="csl-entry">
Nyström, Marcus, and Kenneth Holmqvist. 2010. <span>“<span class="nocase">An adaptive algorithm for fixation, saccade, and glissade
detection in eyetracking data</span>.”</span> <em>Behavior Research
Methods</em> 42 (1): 188–204. <a href="https://doi.org/10.3758/BRM.42.1.188" class="external-link">https://doi.org/10.3758/BRM.42.1.188</a>.
</div>
<div id="ref-Otero-Millan2014" class="csl-entry">
Otero-Millan, J., Jose L Alba Castro, Stephen L Macknik, and S.
Martinez-Conde. 2014. <span>“<span class="nocase">Unsupervised
clustering method to detect microsaccades</span>.”</span> <em>Journal of
Vision</em> 14 (2): 18–18. <a href="https://doi.org/10.1167/14.2.18" class="external-link">https://doi.org/10.1167/14.2.18</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alexander Pastukhov.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
