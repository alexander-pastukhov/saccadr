<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using Custom Methods â€¢ saccadr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using Custom Methods">
<meta property="og:description" content="saccadr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">saccadr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/methods.html">Implemented Methods</a>
    </li>
    <li>
      <a href="../articles/using_custom_methods.html">Using Custom Methods</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using Custom Methods</h1>
            
      
      
      <div class="hidden name"><code>using_custom_methods.Rmd</code></div>

    </div>

    
    
<p>You can pass a custom function to the <code><a href="../reference/extract_saccades.html">extract_saccades()</a></code>
alongside the internally implemented method. The function must be
declared as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_saccade_voting_method</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>                                         <span class="va">y</span>,</span>
<span>                                         <span class="va">vel</span>,</span>
<span>                                         <span class="va">acc</span>,</span>
<span>                                         <span class="va">sample_rate</span>,</span>
<span>                                         <span class="va">trial</span>,</span>
<span>                                         <span class="va">options</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                         </span>
<span>  <span class="co"># implement you method that computes a 0/1 vote per sample</span></span>
<span>  </span>
<span>  <span class="va">sample_votes</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Arguments that are passed to the function (all vectors / tables have
the same length / number of rows):</p>
<ul>
<li>
<code>x</code>, <code>y</code> vectors with <em>monocular</em>
samples (either for one of the eyes or cyclopean). On the one hand, you
can assume that samples are in degrees of visual angle as the package
users are warned that using non-standard units may invalidate some
internally implemented methods. On the other hand, as you are
implementing a custom method for your own data, you can treat them in
the units you see fit (input vectors <code>x</code> and <code>y</code>
are not transformed but for averaging in case of cyclopean data).</li>
<li>
<code>vel</code> and <code>acc</code> are data frames with velocity
and acceleration samples. Each table has columns <code>x</code>
(horizontal component), <code>y</code> (vertical component), and
<code>amp</code> (amplitude). See below for details on velocity
computation.</li>
<li>
<code>sample_rate</code> scalar value in Hz.</li>
<li>
<code>trial</code> vector with trial index per sample.</li>
<li>
<code>options</code> a named list with method specific options. See
example below for how to use them. See also
<code>option_or _default()</code> function.</li>
</ul>
<p>Your function must return a vector of the same length as
<code>x</code> with votes (<span class="math inline">\(1\)</span>
samples belongs to a saccade, <span class="math inline">\(0\)</span> not
a saccade, you can also use logical values).</p>
<div class="section level2">
<h2 id="example-implementation">Example implementation<a class="anchor" aria-label="anchor" href="#example-implementation"></a>
</h2>
<p>Here is an example implementation of an overly simple custom method
that labels a sample as a saccade if its velocity exceeds a predefined
threshold. It expects the threshold parameter as
<code>"st_velocity_threshold"</code> member of the list and uses a
default threshold of <span class="math inline">\(50 \deg / s\)</span>
(an arbitrary number!) if no threshold was provided.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_threshold_method</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>                                    <span class="va">y</span>,</span>
<span>                                    <span class="va">vel</span>,</span>
<span>                                    <span class="va">acc</span>,</span>
<span>                                    <span class="va">sample_rate</span>,</span>
<span>                                    <span class="va">trial</span>,</span>
<span>                                    <span class="va">options</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># obtain method parameters or use defaults</span></span>
<span>  <span class="va">velocity_threshold</span> <span class="op">&lt;-</span> <span class="fu">saccadr</span><span class="fu">::</span><span class="fu"><a href="../reference/option_or_default.html">option_or_default</a></span><span class="op">(</span><span class="va">options</span>, <span class="st">"st_velocity_threshold"</span>, <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># vote on each sample  </span></span>
<span>  <span class="va">sample_vote</span> <span class="op">&lt;-</span> <span class="va">vel</span><span class="op">[[</span><span class="st">'amp'</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">velocity_threshold</span></span>
<span>  </span>
<span>  <span class="co"># return votes</span></span>
<span>  <span class="va">sample_vote</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Once you implemented your method, you can pass it alongside
internally implemented methods:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"single_trial"</span><span class="op">)</span></span>
<span><span class="va">saccades</span> <span class="op">&lt;-</span> <span class="fu">saccadr</span><span class="fu">::</span><span class="fu"><a href="../reference/extract_saccades.html">extract_saccades</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">single_trial</span><span class="op">$</span><span class="va">x</span>,</span>
<span>                                      y <span class="op">=</span> <span class="va">single_trial</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                                      sample_rate <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                                      methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"ek"</span>, <span class="st">"om"</span>, <span class="st">"nh"</span>, <span class="va">simple_threshold_method</span><span class="op">)</span>,</span>
<span>                                      options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"st_velocity_threshold"</span> <span class="op">=</span> <span class="fl">70</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="velocity-computation">Velocity computation<a class="anchor" aria-label="anchor" href="#velocity-computation"></a>
</h2>
<p>Acceleration is computed the same way but from velocity samples.</p>
<p>Horizontal and vertical velocity components are computed as <span class="math display">\[v_x[i] = \frac{\sum_{j=1}^{(N-1)/2}x[i+j] -
x[i-j]}{\sum_{j=1}^{(N-1)/2}2j\cdot\Delta t}\]</span> where <span class="math inline">\(i\)</span> is the index of a sample, <span class="math inline">\(\Delta t = \frac{1}{sample~rate}\)</span> is a
duration of a single sampling frame, and <span class="math inline">\(N\)</span> is an <em>odd</em> integer width of the
moving average used to compute the velocity. In <span class="citation">@EngbertKliegl2003</span>, <span class="math inline">\(N=5\)</span> and <span class="math inline">\(\Delta t = 4\)</span> (250 Hz sampling rate) that
translates into a 20 ms moving average window (default value used in the
method implementation). Below is a derivation that shows the equivalence
of the formula above to formula 1 in <span class="citation">@EngbertKliegl2003</span>. For <span class="math inline">\(N=5\)</span>: <span class="math display">\[\frac{\sum_{j=1}^{(5-1)/2}x[i+j] -
x[i-j]}{\sum_{j=1}^{(5-1)/2}2j\cdot\Delta t}=\]</span> <span class="math display">\[\frac{\sum_{j=1}^{2}x[i+j] -
x[i-j]}{\sum_{j=1}^{2}2j\cdot\Delta t}=\]</span></p>
<p><span class="math display">\[\frac{x[i+1] - x[i-1]+x[i+2] -
x[i-2]}{2\Delta t + 4\Delta t}=\]</span> <span class="math display">\[\frac{x[i+2] + x[i+1] - x[i-1] - x[i-2]}{6\Delta
t}\]</span></p>
<p>As noted in <span class="citation">@Otero-Millan2014</span>, this is
equivalent to smoothing <span class="math inline">\(x\)</span> with a
normalized Bartlett window (<span class="math inline">\(n=6\)</span> for
five-sample velocity computation) and differentiating, see the code
below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># assuming vector `x` and a scalar `sample_rate`</span></span>
<span><span class="va">barlett_window</span> <span class="op">&lt;-</span> <span class="fu">signal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/signal/man/windowing.html" class="external-link">bartlett</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">smoothed_x</span> <span class="op">&lt;-</span> <span class="fu">signal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/signal/man/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">barlett_window</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">barlett_window</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">dx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">smoothed_x</span><span class="op">)</span> <span class="op">*</span> <span class="va">sample_rate</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">v</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">-</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="va">dx</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>However, note that <code><a href="https://rdrr.io/pkg/signal/man/filter.html" class="external-link">signal::filter()</a></code> cannot handle
time-series with missing values (<code>NA</code>).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alexander Pastukhov.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
